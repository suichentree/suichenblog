---
title: 通过添加静态路由实现windows系统下内外网同时访问
date: 2022-06-28
sidebar: 'auto'
categories: 
 - 随笔
---

## 通过添加静态路由实现windows系统下内外网同时访问

> 问题描述

当在公司使用网线连接内网的时候，就无法使用外网。如何同时访问内外网？

> 解决方法

在windows系统中添加静态路由，来实现内外网同时连接的效果。

内网：一般通过网线来连接，基本上是固定ip，固定网关。
外网：一般通过wifi连接。访问的ip不固定。但是网关是固定的。


> 如何查询内外网的网关和ip等信息?

打开cmd,输入命令ipconfig。即可查询当前连接网络的信息。

```
C:\Windows\system32>ipconfig
Windows IP 配置
以太网适配器 以太网:

   IPv4 地址 . . . . . . . . . . . . : 192.168.20.108
   子网掩码  . . . . . . . . . . . . : 255.255.255.0
   默认网关. . . . . . . . . . . . . : 192.168.20.1

无线局域网适配器 WLAN:

   IPv4 地址 . . . . . . . . . . . . : 192.168.11.109
   子网掩码  . . . . . . . . . . . . : 255.255.255.0
   默认网关. . . . . . . . . . . . . : 192.168.11.1
```

```
内网IPv4地址为192.168.20.108,指的是在内网中，这台机器的网络地址是192.168.20.108
WLAN网IPv4地址为192.168.11.109,指的是在WLAN网中，这台机器的网络地址是192.168.11.109
WLAN网本质上也是一个大内网。只不过这个内网与互联网是连通的。
```

> 解决步骤

1. 以管理员身份打开cmd
2. 确定内外网的网关和ip信息是那些，可通过ipconfig查询。
3. 通过route print命令查询静态路由。

![20220630102322.png](../blog_img/20220630102322.png)

4. 删除现有的 0.0.0.0 路由。

```
route delete 0.0.0.0
```
0.0.0.0 路由是默认路由。指的是当路由表中与实际访问地址之间无法匹配时，路由器所选择的路由。


5. 添加内外网静态路由。

```
route add 命令语法: route add -p route 网段地址 mask 子网掩码 网关地址
```

```
外网添加路由（访问外网的数据从192.168.11.1的网关出去），子网掩码0.0.0.0
route add -p 0.0.0.0 mask 0.0.0.0 192.168.11.1
该命令的意思是：无法被路由表匹配的IP数据包，全部由网关192.168.11.1路径转发。-p是永久保存的意思。
```

```
内网添加路由（访问内网10.87.0.0网段的数据从192.168.20.1的网关出去），子网掩码255.255.0.0
route add -p 10.87.0.0 mask 255.255.0.0 192.168.20.1
该命令的意思是：所有发往10.87.0.0地址的IP数据包，全部由网关192.168.20.1路径转发。-p是永久保存的意思。
```

<font color="red">注意1：添加内网静态路由必须在能够访问内网的情况下使用才能生效。否则不会生效。</font>

<font color="red">注意2：当你添加了内网网段的路由到系统中的静态路由表中后，发现内外网还是无法同时连接。这时你可以将静态路由表中的0.0.0.0默认路由删除试试看。可能原因是路由表中的网段冲突了。</font>

6. 添加路由后，可以通过ping命令，来试试内外网能否访问。

