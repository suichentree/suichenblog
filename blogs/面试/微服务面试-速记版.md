---
title: 微服务面试-速记版
date: 2023-10-29
sidebar: 'auto'
categories: 
 - 面试
tags:
 - Java
---

[toc]

# 微服务面试-速记版

## 为什么需要注册中心？

由于微服务架构需要把一个单体应用拆分为各个微小的服务。并且服务与服务之间需要互相配合才能完成一个业务功能。

那么各个服务之间如何互相配合？答案就是注册中心。

注册中心通过记录各个服务的信息，从而让服务与服务之间互相连通。

注册中心中存储的内容是：服务的ip+port+服务配置等。

## 如何设计一个注册中心，需要哪些接口？

- 服务注册接口：把服务注册到注册中心的功能。
- 服务心跳接口：检测注册中心的服务是否有效或者网络是否连通。
- 服务下线接口：把服务从注册中心中下线。
- 服务剔除接口：注册中心将无效的服务，从注册中心表中删除的功能。
- 查询服务接口：给其他服务提供注册中心的注册表的信息。
- 注册表同步接口：当注册中心是集群的时候，提供一个互相之间同步注册表的接口。

## 介绍一下 RESTFUL？

RESTFUL是一种编码约定。对于同一个接口，根据http请求方式的不同，来实现不同的功能。

- 对于get请求，接口实现查询功能。
- 对于post请求，接口实现新增功能。
- 对于put请求，接口实现修改功能。
- 对于delet请求，接口实现删除功能。


## 为什么微服务需要熔断机制？

熔断机制就是当服务发生故障的时候，如何进行响应的一种机制。

> 什么是服务故障？

例如网络波动异常，一时间大流量导致的处理时间过慢的异常，服务不可调用的异常等。

由于微服务架构中服务与服务之间需要互相调用才能实现业务功能。一个业务功能可能需要调用7-8个服务才能实现。但是当某个业务发生故障的时候,可能会导致涉及到该服务的业务功能全部发生故障。

当服务发生故障的时候，为了不让故障服务去影响其他服务的正常使用。我们需要通过熔断机制来限制故障服务的调用。例如直接返回默认值，限制服务的QPS等。

## 熔断和降级的区别？

相同性：熔断和降级都是一种机制。为了防止系统整体响应缓慢的机制。

不同性：熔断一般是某个业务功能中的服务（下游服务）故障导致的。而降级一般是某个服务对于大流量的请求处理缓慢，为了让服务的响应时间加快，从而限制降低了服务的请求处理。

## 微服务设计一般都遵循什么原则？

1. 单一职责原则：服务与服务之间互相独立。每个服务只处理自己的业务。做到高内聚，低耦合。
2. 服务自治原则：每个服务都能做到独立开发，独立测试，独立部署，独立运行。让服务与其他服务进行解耦。
3. 轻量通信原则：服务与服务之间的通信调用是轻量级的，并且能够跨平台，跨语言的。

## Ribbon的原理是什么？

1. 通过拦截器将被注解@LoadBalanced修改的请求进行拦截。
2. 将请求中的服务名信息，会根据注册中心的注册表，解析成具体的ip地址。如果服务名对于多个ip地址，那么ribbon在选择地址的时候，会进行负载均衡。
3. 当确定好ip地址的时候，ribbon会放行请求。

## 什么是Cache aside 缓存更新机制？

Cache aside 缓存更新机制是用于保存数据库和缓存的数据一致性的机制。

Cache aside 缓存更新机制：
1. 当应用读取数据的时候，先从缓存中读取数据，若没有得到，则从数据库中读取数据，成功后，存放到缓存中。
2. 当应用对数据进行更新的时候，先在数据库中对数据进行更新。更新成功后，将缓存中的对应数据进行删除。

> Cache aside 缓存更新机制的问题

当读取操作A比更新操作B先开始，若读取操作A比更新操作B完结束的时候。由于读取操作会将旧数据存储到缓存中，而数据库中存储的是新数据。这种情况下会缓存和数据库的数据会产生不一致。

但是由于读操作正常情况下，比写操作快。因此一般情况下，这个问题发生的概率很低。 

> 如何解决上述问题？

通过延迟双删。即当写操作更新了数据库，并且删除了缓存之后，等待2-3s,再次删除缓存。这样就会保证旧数据不会出现在缓存中。

## 什么是Read/Write Through机制？

尽管Cache aside 缓存更新机制和延迟双删的方法能够保证缓存和数据库的一致性。但是仍然有出现问题的可能。

Read/Write Through机制如下
- 读取操作和缓存交互，直接读取缓存结果。
- 写入操作也和缓存交互，直接将写入结果存储到缓存中。
- 最后缓存本身与数据库进行数据同步。

简而言之，在Read/Write Through机制中当缓存启动的时候，自身将从数据库中读取数据，并存入到缓存中。然后应用的读取写入操作都与缓存交互，缓存自身再与数据库进行数据同步。

Read/Write Through机制：应用读写数据操作-》缓存-》数据库

