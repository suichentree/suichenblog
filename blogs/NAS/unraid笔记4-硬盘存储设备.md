---
title: unraid笔记4-硬盘存储设备
date: 2023-06-06
sidebar: 'auto'
categories: 
 - NAS
tags:
 - unraid
---

[toc]

# unraid笔记4-硬盘存储设备

[转载文章：小刻也能看懂的Unraid系统使用手册](https://www.cnblogs.com/frozensky-alpha/p/15013572.html)

对于一个 NAS 服务器来说，存储数据是最重要的功能，而管理各种存储设备，配置存储空间，保证数据安全是一个NAS系统必备的功能。

unraid可以在主界面管理所有存储设备。并且可以查看它的温度、读写请求、错误、文件系统和空间使用的情况。

Unraid 系统把服务器中的存储设备分为下面这几种进行管理：

## 磁盘阵列设备

注意此处的磁盘阵列不是指RAID阵列。Unraid本身是不支持RAID的（可以通过阵列卡实现硬件RAID）。

磁盘阵列设备有两种，分为 Parity 校验盘和 Disk 数据盘。最大支持2个校验盘和22个数据盘，一共24个硬盘。


### Parity 校验盘

校验盘用来对存储在数据盘中的数据进行奇偶校验，以保护数据安全。当出现磁盘错误时，可以通过校验的方式恢复数据。安装 1 块磁盘作为校验盘时就可以为数据盘提供 1 个冗余（通俗的说1个校验盘可以恢复1个坏掉的数据盘的数据。2个校验盘可以恢复2个坏掉的数据盘的数据）。

校验盘的磁盘容量必须大于或等于数据盘中最大硬盘的容量。目前 Unraid 支持配置最多2块磁盘作为校验盘，这两块磁盘的容量可以是不同的，但仍然会以其中容量最小的为准。(通俗的说2个校验盘中最小的容量要大于等于数据盘中最大硬盘的容量。)

### Disk 数据盘

数据盘用来组成系统的主要存储空间，其容量是所有数据盘容量的总和。比如使用 4 块 4TB 硬盘作为数据盘，则存储空间的总容量就是 16TB。并且由于不使用 RAID 阵列的机制，数据盘可以使用不同容量的磁盘，后续扩展存储空间时更加灵活。

但是注意，如果开启校验功能，则数据盘中的容量最大的那块磁盘的容量不能超过校验盘能提供的最大校验容量。


## 缓存池设备

因为 Unraid的磁盘阵列不同于 RAID 阵列模式，是单盘读写的，增加磁盘并不能提高文件的读写速度。日常用于存储大量数据的机械硬盘的读写速度大概在 100MB/s 到 300MB/s，而固态硬盘的读写速度通常都在 600MB/s 以上，支持 NVME 协议的固态硬盘甚至可以达到 3GB/s 的读写速度。为了提高文件的读写速度，可以配置一块固态硬盘做为缓存盘使用。

固态硬盘的存储空间相比于机械硬盘要小很多，所以并不是所有的文件都可以存放在缓存上的，也不建议把大量文件存放在缓存上，这么做会加速缓存盘的损耗。

Unraid 提供了四种机制来指定哪些文件该使用缓存、该怎样使用缓存。在安装了缓存盘后，新建 Share 文件夹时就可以看到这四种缓存机制：

### No 否

对该文件夹内的文件读写时不使用缓存，直接从序列磁盘上读写。适合存放大文件的文件夹，如电影，剧集等。

### Yes 是

向该共享文件夹写入文件时优先使用缓存，文件将首先写入到缓存上，缓存空间不够则会再写入到磁盘上。Unraid 内置的 Mover 机制会根据设置定期，也可手动将文件从缓存中写入序列磁盘上。

Yes 机制文件先写入缓存，再移动到数据盘，提高了写入速度。适合零碎的小文件，如文档。

### Prefer 首选

向共享文件夹写入文件时会优先写入缓存，当缓存池剩余空间不足时才会将新文件写入数据盘中。在 Mover 启动时，会尽可能把数据盘中的文件移动到缓存中，下次访问这些文件就会从缓存上读取了。

Prefer这种机制不仅提高了文件的写入速度，也尽可能提高了文件的读取速度。Prefer 机制很适合需要频繁访问，频繁修改的文件，也适合存放虚拟机映像和 Docker 应用的文件夹。

### Only 只在

文件只存放在缓存上，Unraid 也不会使用 Mover 移动缓存文件到数据盘上。和 Prefer 机制一样提高了读写速度，但不会写入数据盘上意味着在使用单个缓存盘时，没有冗余，也没有校验盘来保护数据，不适合用来存储重要文件，只适合存储虚拟机镜像和 Docker 的容器。


>Cache 注意事项
由于在使用 Yes 和 Prefer 机制时文件优先写入缓存盘，在一定时间后才会由 Mover 机制将其写入数据盘中。当只有一个缓存盘时，存储在缓存中的数据在还没有被写入数据盘之前是存在风险的。

对于这个问题有下面几种解决方案：
1. 减少 Mover 触发所需的时间。这样缓存内的文件会在短时间内就移动到数据盘。
2. 只使用缓存加速系统文件、虚拟机和 Docker。不用来加速数据盘内文件的读写。
3. 添加第二个缓存盘，启用多设备模式，形成冗余备份。

* 第一种方法可行，但也不能 100% 保证安全。
* 第二种方案让文件不经过缓存直接写入序列，缓存只用于系统相关文件的加速，这样传输文件到序列时是无法享受到缓存的加速的，适合对传输速度没有要求的情况。
* 第三种方案是最稳妥安全的，但是要购买额外的缓存盘。

虽然几种方案各有利弊，但它们都能减少硬盘的频繁读写，可以增加硬盘的休眠时间，在一定程度上减小了系统整体功耗，提高了硬盘的使用寿命。

## 引导设备

引导设备就是Unraid系统的启动U盘。Unraid 用它存储重要的硬盘配置文件，所以在系统运行时是不可以拔掉的。