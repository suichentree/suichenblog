---
title: unraid笔记5-共享文件夹
date: 2023-06-06
sidebar: 'auto'
categories: 
 - NAS
tags:
 - unraid
---

[toc]

# unraid笔记5-共享文件夹

[转载文章：小刻也能看懂的Unraid系统使用手册](https://www.cnblogs.com/frozensky-alpha/p/15013572.html)

为了使用磁盘所组成的庞大存储空间，需要使用 Shares 共享（共享文件夹）功能。创建 Shares 共享非常容易，但作为 Unraid NAS 系统重要的功能之一，使用者应该了解 Shares 的文件和磁盘使用机制，在配置 Shares 共享和存储文件的时候，有一个清晰有条理的策略，这对文件完整性、磁盘扩展性、数据安全性都有很重要的意义。

## unraid自带的共享文件夹

unraid自带的共享文件夹有4个。

* appdata 默认存放App/Docker配置文件config的内容
* domains 默认存放虚拟机的磁盘映像
* isos 在安装虚拟机时用来上传系统安装镜像的目录（非必须在此共享目录）
* system 存放Unraid系统文件，VM模板，Docker映像

## 共享文件夹的存储方式

首先，Unraid 的共享功能是通过 Linux 聚合文件系统来实现的，它允许一个目录下的文件或目录存放在不同的磁盘中。举个例子，从用户的视角看，文件 Ma 和 Mb 都在同一个目录 Movies 下，但在物理层面，文件 Ma 实际存放在 Disk1 上，文件 Mb 实际存放在 Disk2 上。

![unraid_202306072202.png](../blog_img/unraid_202306072202.png)

当创建一个包含多个磁盘的共享目录时，通过聚合文件系统，共享目录下的文件可以跨磁盘存放，那么判断文件应该存放在哪个磁盘就需要 Minimum free space, Allocation method, Split level 这三个选项的设置来决定了。

Minimum free space（最小剩余空间）设置一个值，当共享文件夹所包含某个磁盘剩余容量低于该值时，就不向这个磁盘写入文件了，转而向共享文件夹包含的其他磁盘写入，当所有磁盘都无法写入时会报错。这个值一般设置为 0，如果使用者想要为某个磁盘保留一些空间的话，可以根据实际情况进行设置。

Allocation method（文件分配方法）有三个选项： High Water, Most Free, Fill-Up。

1. Fill-Up 是持续向一个硬盘写入直到填满，再向另一个磁盘写入；
2. Most Free 是每次写入都向剩余空间最多的那个磁盘写入；
3. High Water 是一种均匀各个磁盘剩余空间的写入方式，它基于容量最大的磁盘，使用二分法创建多个“水位线”，举个例子，容量 8TB 硬盘的水位线分别为 4TB, 2TB, 1TB, 512GB...使用 High Water 时，会依次将每个硬盘写入到剩余 4TB 的空间，然后再依次写入到剩余 2TB，1TB...


如图所示，显示了有 8TB, 3TB, 2TB 三个硬盘时，High Water 模式的磁盘写入方式：最开始只会在浅绿色区域进行存储，浅绿色区域存满后，继续在两个深绿色区域进行存储，以此类推。

![unraid_202306072206.png](../blog_img/unraid_202306072206.png)

以上三种文件分配方法互有优劣，取决于所创建的共享具体要存放的文件类型和使用者的文件管理习惯。


4. Split level（分割层级）选项可选 7 个层级，即 level-1 到 level-5，level-any，no。作为使用者可能很困惑这个分割层级是什么意思？有什么作用？官方的指南中对于 Split level 的解释很复杂，其实简单明了的解释是：Unraid 系统为了防止存放在共享的文件过于混乱地分散在各个磁盘而设置的限制。

举个栗子：有两个冰箱（磁盘），冰箱 A 快满了但还没有完全满，冰箱 B 还有很多空间。一天买来一盒蜜饼（文件），想把它们放到冰箱里，如果都放到 A 中，放不下。这时可以选择把一部分蜜饼放进 A 冰箱，剩余的放到 B 里面；另一个选择是把所有蜜饼放到冰箱 B 里。

考虑到数据完整性，很明显会选择第二种。而在 Unraid 中 Split level 就是来做这个选择的。当设置 level-1 (level-top) 时，只有根目录（1级目录）可以被分散在不同的磁盘，其子目录（2级目录）以及目录下的所有文件则必须存储在同一个磁盘上，Unraid 系统不会对 2 级目录进行分割。Split level 的其他几个选项以此类推，其中 level-any 代表数据可以被任意分割在不同磁盘上，no 代表 Unraid 不自动分割数据，而是需要使用者手动去设置，需要涉及命令行的操作，待进阶篇再去讲解。

Split level 的选择和共享中存放的数据类别有很大的关系，比如，本次创建的是用于存储电影文件的共享 "Movies"，那么共享中的文件结构大概是图中这样，Movies 是 1 级目录，每部电影的文件存放在以电影名称命名的文件夹中，是 2 级目录。虽然因为聚合文件系统的关系，用户不需要知道文件存放在哪个磁盘，但实际上用户肯定不希望同一个电影文件夹中的电影文件被分散在不同的磁盘上。这种情况下，将 Split level 选项设置为 level-top(level-1) 就限制了 Unraid 不可以对 2 级以下的目录进行分割，电影文件就老老实实地存放在它自己的文件夹里了。

![unraid_202306072238.png](../blog_img/unraid_202306072238.png)
